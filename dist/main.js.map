{"version":3,"file":"main.js","sources":["../src/main.ts","../src/svghandler.ts"],"sourcesContent":["import { SvgHandler } from './svghandler';\r\n\r\nconst svghandler = new SvgHandler();\r\n\r\nconst bC = document.getElementById('btnClear');\r\n\r\nbC.addEventListener('click', (event) => {\r\n\r\n  svghandler.clear();\r\n\r\n});\r\n","export class SvgHandler {\r\n\r\n  private pristineSvg = `\r\n  <line class=\"bar\" x1=\"20\" y1=\"20\" x2=\"20\" y2=\"80\" />\r\n  <line class=\"line\" x1=\"20\" y1=\"20\" x2=\"780\" y2=\"20\" />\r\n  <line class=\"line\" x1=\"20\" y1=\"35\" x2=\"780\" y2=\"35\" />\r\n  <line class=\"line\" x1=\"20\" y1=\"50\" x2=\"780\" y2=\"50\" />\r\n  <line class=\"line\" x1=\"20\" y1=\"65\" x2=\"780\" y2=\"65\" />\r\n  <line class=\"line\" x1=\"20\" y1=\"80\" x2=\"780\" y2=\"80\" />\r\n  <line class=\"bar\" x1=\"780\" y1=\"20\" x2=\"780\" y2=\"80\" /> \r\n  `;\r\n  private vp = document.getElementById('viewport');\r\n  private vpDiv = document.getElementById('viewportContainer');\r\n  private fretbusyDiv = document.getElementsByClassName('fretbusy');\r\n  private lines: HTMLCollectionOf<Element>;\r\n  private activeLineIndex;\r\n  private svgTop;\r\n  private topMargin = 20;\r\n  private lineSpace = 15;\r\n  private aantalSnaren = 5;\r\n  private aantalFrets = 22;\r\n  private keyMilliseconds = 300;\r\n  private acceptedFretKeys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']\r\n  private lastKeyPressed = Date.now();\r\n  private lastKey = '';\r\n  private keyBusy = false;\r\n  private _fretBusy = false;\r\n    \r\n  constructor() {\r\n\r\n    this.svgTop = this.vpDiv.offsetTop;\r\n    \r\n    document.addEventListener('click', (event: MouseEvent) => {\r\n      this.activeLineIndex = Math.round((event.pageY - (this.svgTop + this.topMargin)) / this.lineSpace);\r\n      this.activateLine();\r\n    });\r\n    \r\n    document.addEventListener('keyup', (event: KeyboardEvent) => {\r\n      this.handleKeyUp(event);    \r\n    });\r\n\r\n    this.clear();\r\n  }\r\n\r\n      /*\r\n    +\r\n      <text x=\"20\" y=\"35\" class=\"tp\" stroke=\"red\">0</text> + \r\n      <text x=\"30\" y=\"35\" class=\"tp\">1</text> +\r\n      <text x=\"40\" y=\"35\" class=\"tp\">2</text> +\r\n      <text x=\"50\" y=\"35\" class=\"tp\">3</text> +\r\n      <text x=\"60\" y=\"35\" class=\"tp\">4</text>\r\n      */       \r\n\r\n  clear() {\r\n    this.vp.innerHTML = this.pristineSvg;\r\n    this.grabElements();;\r\n  }\r\n\r\n  private grabElements() {\r\n    this.lines = document.getElementsByClassName('line');\r\n  }\r\n\r\n  private activateLine() {\r\n\r\n    if (!this.lines) {\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < this.lines.length; i++) {\r\n      if(this.lines[i].classList.contains('activeline')){\r\n        this.lines[i].classList.toggle('activeline');    \r\n      }    \r\n    }\r\n\r\n    if(this.activeLineIndex >= 0 && this.activeLineIndex < this.aantalSnaren) {\r\n      this.lines[this.activeLineIndex].classList.toggle('activeline');\r\n    }\r\n  }\r\n\r\n  private handleKeyUp(event: KeyboardEvent): void {\r\n\r\n    this.fretBusy = true;\r\n\r\n    if(this.activeLineIndex >= 0 && this.activeLineIndex < this.aantalSnaren) {\r\n      switch(event.key) {\r\n        case 'ArrowUp':{\r\n          this.activeLineIndex = Math.max(0, this.activeLineIndex - 1);\r\n          this.activateLine();\r\n          return;\r\n        }\r\n        case 'ArrowDown': {\r\n          this.activeLineIndex = Math.min(this.aantalSnaren -1, this.activeLineIndex + 1);\r\n          this.activateLine();\r\n          return;\r\n        }\r\n        case this.acceptedFretKeys[event.key]: {\r\n          const now = Date.now();\r\n          const deadline = this.lastKeyPressed + this.keyMilliseconds;\r\n  \r\n          if (now >= deadline){\r\n            this.keyBusy = false;\r\n            this.lastKey = event.key;\r\n          } else {\r\n            this.keyBusy = true;\r\n            this.lastKey += event.key;\r\n          }\r\n          this.lastKeyPressed = Date.now();\r\n  \r\n          setTimeout(() => { \r\n            if (!this.keyBusy) {\r\n              this.maakNoot(this.lastKey); \r\n            }\r\n            this.fretBusy = false;\r\n            this.keyBusy = false;\r\n          }, this.keyMilliseconds);\r\n          \r\n          return;\r\n        }\r\n        default: {\r\n          return;\r\n        }\r\n      }   \r\n    }\r\n  }\r\n\r\n  get fretBusy(): boolean {\r\n    return this._fretBusy;\r\n  }\r\n\r\n  set fretBusy(value: boolean) {\r\n    this._fretBusy = value;\r\n    for (let i = 0; i < this.fretbusyDiv.length; i++){\r\n      if (this._fretBusy) {\r\n        this.fretbusyDiv[i].classList.remove('not-visible')\r\n        this.fretbusyDiv[i].classList.add('visible')\r\n      } else {\r\n        this.fretbusyDiv[i].classList.remove('visible')\r\n        this.fretbusyDiv[i].classList.add('not-visible')\r\n      }\r\n    }\r\n  }\r\n\r\n  private maakNoot(fretAsString: string) {\r\n    const fret = parseInt(fretAsString);\r\n    if(fret > this.aantalFrets) {\r\n      return;\r\n    }\r\n    console.log(`ik maak de noot ${fret}`);\r\n  }\r\n\r\n}\r\n"],"names":["svghandler","pristineSvg","vp","document","getElementById","vpDiv","fretbusyDiv","getElementsByClassName","topMargin","lineSpace","aantalSnaren","aantalFrets","keyMilliseconds","acceptedFretKeys","lastKeyPressed","Date","now","lastKey","keyBusy","_fretBusy","svgTop","this","offsetTop","addEventListener","event","_this","activeLineIndex","Math","round","pageY","activateLine","handleKeyUp","clear","innerHTML","grabElements","lines","i","length","classList","contains","toggle","fretBusy","key","max","min","setTimeout","_this2","maakNoot","fretAsString","fret","parseInt","console","log","value","remove","add"],"mappings":"uBAEMA,EAAa,4CCATC,6aASAC,GAAKC,SAASC,eAAe,iBAC7BC,MAAQF,SAASC,eAAe,0BAChCE,YAAcH,SAASI,uBAAuB,iBAI9CC,UAAY,QACZC,UAAY,QACZC,aAAe,OACfC,YAAc,QACdC,gBAAkB,SAClBC,iBAAmB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,UACjEC,eAAiBC,KAAKC,WACtBC,QAAU,QACVC,SAAU,OACVC,GAAY,OAIbC,OAASC,KAAKhB,MAAMiB,UAEzBnB,SAASoB,iBAAiB,SAAS,SAACC,GAClCC,EAAKC,gBAAkBC,KAAKC,OAAOJ,EAAMK,OAASJ,EAAKL,OAASK,EAAKjB,YAAciB,EAAKhB,WACxFgB,EAAKK,kBAGP3B,SAASoB,iBAAiB,SAAS,SAACC,GAClCC,EAAKM,YAAYP,WAGdQ,qCAYPA,MAAA,gBACO9B,GAAG+B,UAAYZ,KAAKpB,iBACpBiC,kBAGCA,aAAR,gBACOC,MAAQhC,SAASI,uBAAuB,WAGvCuB,aAAR,cAEOT,KAAKc,WAIL,IAAIC,EAAI,EAAGA,EAAIf,KAAKc,MAAME,OAAQD,IAClCf,KAAKc,MAAMC,GAAGE,UAAUC,SAAS,oBAC7BJ,MAAMC,GAAGE,UAAUE,OAAO,cAIhCnB,KAAKK,iBAAmB,GAAKL,KAAKK,gBAAkBL,KAAKX,mBACrDyB,MAAMd,KAAKK,iBAAiBY,UAAUE,OAAO,kBAI9CT,YAAR,SAAoBP,sBAEbiB,UAAW,EAEbpB,KAAKK,iBAAmB,GAAKL,KAAKK,gBAAkBL,KAAKX,oBACnDc,EAAMkB,SACN,sBACEhB,gBAAkBC,KAAKgB,IAAI,EAAGtB,KAAKK,gBAAkB,aACrDI,mBAGF,wBACEJ,gBAAkBC,KAAKiB,IAAIvB,KAAKX,aAAc,EAAGW,KAAKK,gBAAkB,aACxEI,oBAGFT,KAAKR,iBAAiBW,EAAMkB,YACnB3B,KAAKC,OACAK,KAAKP,eAAiBO,KAAKT,sBAGrCM,SAAU,OACVD,QAAUO,EAAMkB,WAEhBxB,SAAU,OACVD,SAAWO,EAAMkB,UAEnB5B,eAAiBC,KAAKC,WAE3B6B,YAAW,WACJC,EAAK5B,SACR4B,EAAKC,SAASD,EAAK7B,SAErB6B,EAAKL,UAAW,EAChBK,EAAK5B,SAAU,IACdG,KAAKT,oCA4BRmC,SAAR,SAAiBC,OACTC,EAAOC,SAASF,GACnBC,EAAO5B,KAAKV,aAGfwC,QAAQC,uBAAuBH,4BAtBjC,kBACS5B,KAAKF,OAGd,SAAakC,QACNlC,EAAYkC,MACZ,IAAIjB,EAAI,EAAGA,EAAIf,KAAKf,YAAY+B,OAAQD,IACvCf,KAAKF,QACFb,YAAY8B,GAAGE,UAAUgB,OAAO,oBAChChD,YAAY8B,GAAGE,UAAUiB,IAAI,kBAE7BjD,YAAY8B,GAAGE,UAAUgB,OAAO,gBAChChD,YAAY8B,GAAGE,UAAUiB,IAAI,+MDrI/BpD,SAASC,eAAe,YAEhCmB,iBAAiB,SAAS,SAACC,GAE5BxB,EAAWgC"}